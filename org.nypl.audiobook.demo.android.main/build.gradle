apply plugin: 'com.android.application'
apply plugin: 'kotlin-android'

/*
 * Copy some properties from the local.properties file into a properties file used to populate
 * various fields in the application.
 */

task generatePropertiesResources {
  def local_props_file = new File(project.rootProject.projectDir, "local.properties")
  def local_props = new Properties()

  local_props.load(new FileInputStream(local_props_file))

  def user_name = local_props.get("feed.user_name")
  def password = local_props.get("feed.password")
  def borrow_uri = local_props.get("feed.borrow_uri")

  if (user_name == null) {
    throw new IllegalArgumentException("Please specify feed.user_name in local.properties")
  }
  if (password == null) {
    throw new IllegalArgumentException("Please specify feed.password in local.properties")
  }
  if (borrow_uri == null) {
    throw new IllegalArgumentException("Please specify feed.borrow_uri in local.properties")
  }

  def directory = new File(project.projectDir, "src/main/assets").absoluteFile
  directory.mkdirs()
  def file = new File(directory, "app.properties")
  file.createNewFile()

  def properties = new Properties()
  properties.setProperty("feed.user_name", user_name)
  properties.setProperty("feed.password", password)
  properties.setProperty("feed.borrow_uri", borrow_uri)
  properties.store(new FileOutputStream(file), "Automatically generated - DO NOT EDIT")
}

preBuild.dependsOn generatePropertiesResources

android {
  compileSdkVersion 27
  buildToolsVersion "27.0.3"

  packagingOptions {

  }
}

dependencies {
  annotationProcessor "com.google.auto.value:auto-value:1.3"

  implementation "io.audioengine.mobile:all-android:7.2.11"
  implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version"

  implementation group: 'joda-time', name: 'joda-time', version: '2.9.9'
  implementation group: 'com.fasterxml.jackson.core', name: 'jackson-databind', version: '2.9.5'
  implementation group: 'org.slf4j', name: 'slf4j-api', version: '1.7.25'
  implementation 'com.github.stephenc.jcip:jcip-annotations:1.0-1'

  implementation 'com.github.tony19:logback-android-core:1.1.1-6'
  implementation('com.github.tony19:logback-android-classic:1.1.1-6') {
    // https://github.com/tony19/logback-android/issues/73
    exclude group: 'com.google.android', module: 'android'
  }
}

repositories {
  mavenCentral()
}
